# SPY Magnitude Regression Experiment
# Focus on predicting return magnitude instead of direction classification
# This avoids the class imbalance problem (67% FLAT)
# Data is configured separately via --data-config (default: NASDAQ 100)

experiment:
  name: "spy_magnitude_regression"
  seed: 42
  output_dir: "outputs"

features:
  technical:
    - sma_20
    - sma_50
    - rsi_14
    - macd
    - macd_signal
    - bbands_upper
    - bbands_lower
    - atr_14
  
  price:
    - log_returns
    - volatility_20
  
  normalize: true
  normalize_method: "zscore"

model:
  type: "transformer"
  hidden_dim: 256
  dropout: 0.2
  lookback: 60
  
  transformer:
    num_heads: 8
    num_layers: 6
    ff_dim: 1024

training:
  trainer: "supervised"
  epochs: 100
  batch_size: 128
  learning_rate: 0.001
  weight_decay: 0.0001
  lookback: 60
  device: "auto"
  
  # Focus training on magnitude prediction
  loss_weights:
    direction: 0.0      # Disabled - no classification
    magnitude: 1.0      # Primary focus
    volatility: 0.3     # Secondary - helps with risk sizing
  
  scheduler:
    type: "adaptive_plateau"
    patience: 10
    factor: 0.1
    max_reductions: 4
    restart_lr_factor: 0.5
  
  early_stopping:
    enabled: true
    patience: 20
    min_delta: 0.0001
  
  warmup_epochs: 5
  
  checkpoint:
    save_best: true
    metric: "val_loss"

backtest:
  initial_capital: 100000
  signal_mode: "magnitude"
  long_threshold: 0.002     # Go long if predicted return > 0.2%
  short_threshold: -0.002   # Go short if predicted return < -0.2%
  
  commission:
    type: "per_share"
    value: 0.01
  
  slippage:
    type: "percentage"
    value: 0.001
  
  position_sizing:
    method: "fixed_fraction"
    fraction: 0.2
    max_position: 0.5

risk:
  max_drawdown: 0.2
  daily_loss_limit: 0.05
  max_positions: 1
  max_position_size: 0.5
  
  kill_switch:
    enabled: true
    trigger_drawdown: 0.15
